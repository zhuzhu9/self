# 中断

[TOC]

## 简介

**中断发生**：CPU在处理某一事件A时，发生了另一事件B请求CPU迅速去处理；

**中断响应**和**中断服务**：CPU暂时中断当前的工作，转去处理事件B；

**中断**：待CPU将事件B处理完毕后，再回到原来事件A被中断的地方继续处理事件A（**中断返回**），

**中断源**：引起CPU中断的根源；中断源向CPU提出中断请求。

**中断返回**：CPU暂时中断原来的事件A，转去处理事件B，对事件B处理完毕后，再回到原来被中断的地方（即**断点**）

实现上述中断功能的部件称为**中断系统**



## 优点

解决了快速主机与慢速I/O设备的数据传送问题

分时操作—CPU可以分时为多个I/O设备服务，提高了计算机的利用率；

实时响应—CPU能够及时处理应用系统的随机事件，系统的实时性大大增强；

可靠性高—CPU具有处理设备故障及掉电等突发事件能力，从而使系统可靠性提高。

## **中断优先级**

CPU同时接收到几个中断时，首先响应优先级别最高的中断请求。

正在进行的中断过程不能被新的同级或低优先级的中断请求所中断。

正在进行的低优先级中断服务，能被高优先级中断请求所中断。

## 外部中断 内部中断  定时器中断

定时器中断应该算是软中断吧，看门狗可以是硬中断，外部中断串口中断这些如果都是设备的话都接gpio分优先级高低和速度快慢。



这三个都属于中断源，独立互不干扰。中断通过优先级来分配先后顺序。外部中断一般指Io高低电平来触发并响应Io的中断函数。定时中断则指到了一定时间就进入定时响应函数。串口中断就是串口的数据寄存器不为空时进入他的中断。

外部中断一般指的是处理器提供给外部设备的中断；定时器中断和串口中断一般是处理器内部的定时器和串口模块的中断。这些中断都连接到处理器内部的中断控制器上，由中断控制器来控制。

中断是否发生都由处理器中断控制器控制，定时器、串口等是片上外设，直接与中断控制器（nvic之类）连接，一旦定时器等片上外设有中断标志，nvic允许，就触发中断；

外部中断是留给片外的其他设备（通过引脚连接，gpio），这种由于中断资源有限（数量，很少能每个引脚都能产生中断吧）、需要映射到哪些引脚、上升沿还是下降沿等等，一般不是直接连接nvic，多了一个专门控制这些的，就外部中断/事件控制器，EXTI，这个和定时器同等是片上外设，外部信号经过exti产生中断标志，（exti连接至nvic），再经nvic看是否触发。

这样，它上面的中断资源就称为外部中断，这些就需要配置引脚属性、触发方式等。
我是这样理解的

类似这种引起硬件中断冲突的问题，通常是代码不良问题。中断处理占用时间太久，导致其他中断异常。比如，我见过的糟糕的代码，是在中断里用CPU延时的。

硬件中断要求快进快出，一般不要在中断中处理实际业务。

比方说，串口接收中断中，只处理将数据加入缓存，然后置标志位或发信号量方式通知主程序或任务进行数据解析。定时中断也是如此。除非进行I/O操作，都应采用通知方式处理业务。

少数情况下，业务时序要求特别高的，那也应该采用在硬中断中开启软中断方式，来处理业务。这样优先级会低于所有的硬中断，不会影响其他中断触发，又保证业务实时处理。

Stm32f407已经非常强悍了，不用怀疑处理器会有问题。我曾经的一个407应用，几乎开启了所有的外设，以太网，USB，串口，SPI，I2C，Camera，外挂液晶屏，还跑一个很耗处理器的算法，一点没问题。















